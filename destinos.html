<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Destinos de Rota com Eliminação (Partida LIS)</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        /* Estilo para o botão de eliminar */
        .delete-btn {
            background-color: #ef4444; /* Red 500 */
            color: white;
            padding: 0.3rem 0.6rem;
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 0.75rem;
            transition: background-color 0.15s;
        }
        .delete-btn:hover {
            background-color: #dc2626; /* Red 600 */
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="max-w-7xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-6 border-b pb-2">Gestão de Destinos de Voo</h1>
        <p class="text-sm text-gray-500 mb-6">Ponto de Partida Fixo: LIS (38.7223, -9.1393)</p>
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- FORMULÁRIO DE ADIÇÃO DE DESTINO (1/3 da largura em desktop) -->
            <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg h-fit">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Adicionar Novo Destino</h2>
                
                <form id="addDestinationForm" class="space-y-4">
                    
                    <div>
                        <label for="cityName" class="block text-sm font-medium text-gray-700">Nome (Cidade ou País):</label>
                        <input type="text" id="cityName" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 text-sm border focus:ring-[#50B6E8] focus:border-[#50B6E8]" placeholder="Ex: Rio de Janeiro">
                    </div>

                    <div>
                        <label for="iataCode" class="block text-sm font-medium text-gray-700">Código IATA (3 letras):</label>
                        <input type="text" id="iataCode" required maxlength="5" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 text-sm border focus:ring-[#50B6E8] focus:border-[#50B6E8]" placeholder="Ex: GIG">
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label for="endLat" class="block text-sm font-medium text-gray-700">Latitude:</label>
                            <input type="number" id="endLat" required step="any" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 text-sm border focus:ring-[#50B6E8] focus:border-[#50B6E8]" placeholder="Ex: -22.9">
                        </div>
                        <div>
                            <label for="endLng" class="block text-sm font-medium text-gray-700">Longitude:</label>
                            <input type="number" id="endLng" required step="any" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 text-sm border focus:ring-[#50B6E8] focus:border-[#50B6E8]" placeholder="Ex: -43.2">
                        </div>
                    </div>

                    <div>
                        <label for="color" class="block text-sm font-medium text-gray-700">Cor da Rota (Hex):</label>
                        <input type="text" id="color" value="#F97316" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 text-sm border focus:ring-[#50B6E8] focus:border-[#50B6E8]" placeholder="#RRGGBB">
                    </div>
                    
                    <button type="submit" class="w-full mt-6 px-4 py-3 bg-[#50B6E8] text-white font-bold rounded-lg shadow-md hover:bg-sky-500 transition duration-150">
                        Adicionar Destino à Tabela
                    </button>
                </form>

                <div id="messageBox" class="mt-4 text-center text-sm font-medium hidden rounded-lg p-3" role="alert"></div>
            </div>

            <!-- TABELA DE DESTINOS (2/3 da largura em desktop) -->
            <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Destinos Atuais (Rotas LIS)</h2>
                
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Cor
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Nome (Cidade/País)
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Cód. IATA
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Latitude
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Longitude
                                </th>
                                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Ação
                                </th>
                            </tr>
                        </thead>
                        <tbody id="destinationsTableBody" class="bg-white divide-y divide-gray-200">
                            <!-- Os dados serão injetados aqui pelo JavaScript -->
                        </tbody>
                    </table>
                </div>

                <!-- Modal de Confirmação (customizado para evitar alert/confirm) -->
                <div id="deleteModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50">
                    <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-sm">
                        <h3 class="text-lg font-bold mb-4">Confirmar Eliminação</h3>
                        <p class="text-gray-600 mb-6">Tem a certeza que deseja eliminar o destino <span id="modalDestinationName" class="font-semibold text-gray-800"></span>?</p>
                        <div class="flex justify-end space-x-3">
                            <button id="cancelDeleteBtn" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition">
                                Cancelar
                            </button>
                            <button id="confirmDeleteBtn" class="px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 transition">
                                Eliminar
                            </button>
                        </div>
                    </div>
                </div>

            </div>

        </div>
    </div>

    <script>
        // Coordenadas do ponto de partida fixo (LIS)
        const FIXED_START_LAT = 38.7223;
        const FIXED_START_LNG = -9.1393;

        // Dados iniciais (adicionado 'id' para facilitar a remoção)
        let destinations = [
            { id: 1, name: 'Luanda', code: 'LAD', color: '#50B6E8', endLat: -8.8383, endLng: 13.2344 },
            { id: 2, name: 'Libreville', code: 'LBV', color: '#50B6E8', endLat: 0.4162, endLng: 9.4673 },
            { id: 3, name: 'Tripoli', code: 'TIP', color: '#50B6E8', endLat: 32.8872, endLng: 13.5888 },
            { id: 4, name: 'Casablanca', code: 'CMN', color: '#50B6E8', endLat: 33.5731, endLng: -7.5898 },
            { id: 5, name: 'Maputo', code: 'MPM', color: '#50B6E8', endLat: -25.9653, endLng: 32.5832 },
            { id: 6, name: 'São Tomé', code: 'TMS', color: '#50B6E8', endLat: 0.3366, endLng: 6.7325 },
            { id: 7, name: 'Cairo', code: 'CAI', color: '#50B6E8', endLat: 30.0444, endLng: 31.2357 },
            { id: 8, name: 'Abidjan', code: 'ABJ', color: '#50B6E8', endLat: 5.36, endLng: -4.0083 },
            { id: 9, name: 'Praia', code: 'RAI', color: 'rgba(255,255,255,0.8)', endLat: 14.9213, endLng: -23.5085 },
            { id: 10, name: 'Buenos Aires', code: 'BUE', color: '#50B6E8', endLat: -34.5997, endLng: -58.3819 },
            { id: 11, name: 'Brasília', code: 'BSB', color: '#50B6E8', endLat: -15.7939, endLng: -47.8828 },
            { id: 12, name: 'Ottawa', code: 'YOW', color: '#50B6E8', endLat: 45.4215, endLng: -75.6972 },
            { id: 13, name: 'Santiago', code: 'SCL', color: '#50B6E8', endLat: -33.4489, endLng: -70.6693 },
            { id: 14, name: 'Bogotá', code: 'BOG', color: '#50B6E8', endLat: 4.711, endLng: -74.0721 },
            { id: 15, name: 'Santo Domingo', code: 'SDQ', color: '#50B6E8', endLat: 18.4861, endLng: -69.9312 },
            { id: 16, name: 'San Salvador', code: 'SAL', color: '#50B6E8', endLat: 13.6929, endLng: -89.2182 },
            { id: 17, name: 'Guatemala City', code: 'GUA', color: '#50B6E8', endLat: 14.6349, endLng: -90.5069 },
            { id: 18, name: 'Tegucigalpa', code: 'TGU', color: '#50B6E8', endLat: 14.0723, endLng: -87.2068 },
            { id: 19, name: 'Mexico City', code: 'MEX', color: '#50B6E8', endLat: 19.4326, endLng: -99.1332 },
            { id: 20, name: 'Panama City', code: 'PTY', color: '#50B6E8', endLat: 8.9824, endLng: -79.5199 },
            { id: 21, name: 'Lima', code: 'LIM', color: '#50B6E8', endLat: -12.0464, endLng: -77.0428 },
            { id: 22, name: 'New York (JFK)', code: 'JFK', color: '#50B6E8', endLat: 40.6611, endLng: -73.945 },
            { id: 23, name: 'Los Angeles (LAX)', code: 'LAX', color: '#50B6E8', endLat: 34.0522, endLng: -118.2437 },
            { id: 24, name: 'Vienna', code: 'VIE', color: '#50B6E8', endLat: 48.2084, endLng: 16.3738 },
            { id: 25, name: 'Brussels', code: 'BRU', color: '#50B6E8', endLat: 50.8471, endLng: 4.3661 },
            { id: 26, name: 'Zagreb', code: 'ZAG', color: '#50B6E8', endLat: 45.815, endLng: 15.9819 },
            { id: 27, name: 'Nicosia', code: 'NIC', color: '#50B6E8', endLat: 35.1856, endLng: 33.3823 },
            { id: 28, name: 'Prague', code: 'PRG', color: '#50B6E8', endLat: 50.0755, endLng: 14.4378 },
            { id: 29, name: 'Copenhagen', code: 'CPH', color: '#50B6E8', endLat: 55.6761, endLng: 12.5683 },
            { id: 30, name: 'Madrid', code: 'MAD', color: '#50B6E8', endLat: 40.4169, endLng: -3.7034 },
            { id: 31, name: 'Tallinn', code: 'TLL', color: '#50B6E8', endLat: 59.437, endLng: 24.7536 },
            { id: 32, name: 'Helsinki', code: 'HEL', color: '#50B6E8', endLat: 60.1695, endLng: 24.9355 },
            { id: 33, name: 'Paris (CDG)', code: 'CDG', color: '#50B6E8', endLat: 48.8567, endLng: 2.3522 },
            { id: 34, name: 'Berlin', code: 'BER', color: '#50B6E8', endLat: 52.5167, endLng: 13.3833 },
            { id: 35, name: 'Athens', code: 'ATH', color: '#50B6E8', endLat: 37.9838, endLng: 23.7275 },
            { id: 36, name: 'Budapest', code: 'BUD', color: '#50B6E8', endLat: 47.4979, endLng: 19.0402 },
            { id: 37, name: 'Rome (FCO)', code: 'FCO', color: '#50B6E8', endLat: 41.8933, endLng: 12.4828 },
            { id: 38, name: 'Vilnius', code: 'VNO', color: '#50B6E8', endLat: 54.6872, endLng: 25.2797 },
            { id: 39, name: 'Luxembourg', code: 'LUX', color: '#50B6E8', endLat: 49.8153, endLng: 6.1296 },
            { id: 40, name: 'Amsterdam', code: 'AMS', color: '#50B6E8', endLat: 52.3702, endLng: 4.8952 },
            { id: 41, name: 'Belfast', code: 'BFS', color: '#50B6E8', endLat: 54.5973, endLng: -5.9301 },
            { id: 42, name: 'Oslo', code: 'OSL', color: '#50B6E8', endLat: 59.9139, endLng: 10.7522 },
            { id: 43, name: 'Warsaw', code: 'WAW', color: '#50B6E8', endLat: 52.2322, endLng: 21.0122 },
            { id: 44, name: 'Porto', code: 'OPO', color: '#50B6E8', endLat: 41.1496, endLng: -8.6109 },
            { id: 45, name: 'Minsk', code: 'MSQ', color: '#50B6E8', endLat: 53.9045, endLng: 27.5615 },
            { id: 46, name: 'Bucharest', code: 'OTP', color: '#50B6E8', endLat: 44.4268, endLng: 26.1025 },
            { id: 47, name: 'Moscow (SVO)', code: 'SVO', color: '#50B6E8', endLat: 55.7558, endLng: 37.6173 },
            { id: 48, name: 'Bratislava', code: 'BTS', color: '#50B6E8', endLat: 48.1486, endLng: 17.1077 },
            { id: 49, name: 'Ljubljana', code: 'LJU', color: '#50B6E8', endLat: 46.0569, endLng: 14.5058 },
            { id: 50, name: 'Stockholm', code: 'ARN', color: '#50B6E8', endLat: 59.3293, endLng: 18.0686 },
            { id: 51, name: 'Zurich', code: 'ZRH', color: '#50B6E8', endLat: 47.3769, endLng: 8.5417 },
            { id: 52, name: 'London (LHR)', code: 'LHR', color: '#50B6E8', endLat: 51.5099, endLng: -0.118 },
            { id: 53, name: 'Riyadh', code: 'RUH', color: '#50B6E8', endLat: 24.6333, endLng: 46.7167 },
            { id: 54, name: 'Beijing', code: 'PEK', color: '#50B6E8', endLat: 39.9042, endLng: 116.4074 },
            { id: 55, name: 'Jakarta (CGK)', code: 'CGK', color: '#50B6E8', endLat: -6.2088, endLng: 106.8456 },
            { id: 56, name: 'Tehran', code: 'THR', color: '#50B6E8', endLat: 35.6892, endLng: 51.389 },
            { id: 57, name: 'Tel Aviv', code: 'TLV', color: '#50B6E8', endLat: 32.0853, endLng: 34.7818 },
            { id: 58, name: 'Amman', code: 'AMM', color: '#50B6E8', endLat: 31.9454, endLng: 35.9284 },
            { id: 59, name: 'Kuwait City', code: 'KWI', color: '#50B6E8', endLat: 29.3786, endLng: 47.9904 },
            { id: 60, name: 'Beirut', code: 'BEY', color: '#50B6E8', endLat: 33.8938, endLng: 35.5018 },
            { id: 61, name: 'Ulaanbaatar', code: 'ULN', color: '#50B6E8', endLat: 47.9213, endLng: 106.9186 },
            { id: 62, name: 'Manila', code: 'MNL', color: '#50B6E8', endLat: 14.5995, endLng: 120.9842 },
            { id: 63, name: 'Doha', code: 'DOH', color: '#50B6E8', endLat: 25.2854, endLng: 51.531 },
            { id: 64, name: 'Jeddah', code: 'JED', color: '#50B6E8', endLat: 21.4858, endLng: 39.1925 },
            { id: 65, name: 'Taipei', code: 'TPE', color: '#50B6E8', endLat: 25.033, endLng: 121.5654 },
            { id: 66, name: 'Dubai', code: 'DXB', color: '#50B6E8', endLat: 25.2048, endLng: 55.2708 },
            { id: 67, name: 'Tashkent', code: 'TAS', color: '#50B6E8', endLat: 41.2995, endLng: 69.2401 },
            { id: 68, name: 'Sydney', code: 'SYD', color: '#50B6E8', endLat: -33.8678, endLng: 151.2073 }
        ];

        // Variável para gerar novos IDs
        let nextId = destinations.length > 0 ? Math.max(...destinations.map(d => d.id)) + 1 : 1;

        // Variável para armazenar o ID do destino a ser eliminado
        let destinationIdToDelete = null;

        // Função para formatar as coordenadas para exibição
        function formatCoordinate(coord) {
            return coord.toFixed(4);
        }

        // Função para renderizar a tabela
        function renderTable() {
            const tableBody = document.getElementById('destinationsTableBody');
            tableBody.innerHTML = ''; // Limpa o conteúdo existente

            destinations.forEach(dest => {
                const row = tableBody.insertRow();
                row.className = 'hover:bg-gray-100 transition duration-100';

                // Coluna Cor
                let cellColor = row.insertCell();
                cellColor.className = 'px-3 py-4 whitespace-nowrap text-sm text-gray-900';
                cellColor.innerHTML = `<div class="w-4 h-4 rounded-full shadow-md" style="background-color: ${dest.color}"></div>`;
                
                // Coluna Nome
                let cellName = row.insertCell();
                cellName.className = 'px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900';
                cellName.textContent = dest.name;

                // Coluna Código IATA
                let cellCode = row.insertCell();
                cellCode.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-500 font-mono';
                cellCode.textContent = dest.code;

                // Coluna Latitude
                let cellLat = row.insertCell();
                cellLat.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-500';
                cellLat.textContent = formatCoordinate(dest.endLat);

                // Coluna Longitude
                let cellLng = row.insertCell();
                cellLng.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-500';
                cellLng.textContent = formatCoordinate(dest.endLng);

                // Coluna Ação (Botão Eliminar)
                let cellAction = row.insertCell();
                cellAction.className = 'px-6 py-4 whitespace-nowrap text-center text-sm font-medium';
                cellAction.innerHTML = `<button data-id="${dest.id}" data-name="${dest.name}" class="delete-btn">Eliminar</button>`;
            });

            // Adiciona listeners aos novos botões de eliminar
            document.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', handleDeleteClick);
            });
        }

        // Função para mostrar mensagens de feedback
        function showMessage(text, isError = false) {
            const messageBox = document.getElementById('messageBox');
            messageBox.textContent = text;
            if (isError) {
                messageBox.className = 'mt-4 text-center text-sm font-medium rounded-lg p-3 bg-red-100 text-red-700 block';
            } else {
                messageBox.className = 'mt-4 text-center text-sm font-medium rounded-lg p-3 bg-green-100 text-green-700 block';
            }
        }

        // Função para lidar com o envio do formulário
        function handleAddDestination(event) {
            event.preventDefault(); 

            const cityName = document.getElementById('cityName').value.trim();
            const iataCode = document.getElementById('iataCode').value.trim().toUpperCase();
            const endLat = parseFloat(document.getElementById('endLat').value);
            const endLng = parseFloat(document.getElementById('endLng').value);
            const color = document.getElementById('color').value.trim() || '#F97316';

            // 1. Validação
            if (cityName === '' || iataCode.length < 3 || isNaN(endLat) || isNaN(endLng)) {
                showMessage('Por favor, preencha o Nome, o Código IATA (mín. 3 letras) e as Coordenadas válidas.', true);
                return;
            }
            if (endLat < -90 || endLat > 90 || endLng < -180 || endLng > 180) {
                showMessage('Coordenadas inválidas. Latitude: [-90, 90]. Longitude: [-180, 180].', true);
                return;
            }

            // 2. Criação do novo destino
            const newDestination = {
                id: nextId++, // Atribui e incrementa o ID
                name: cityName,
                code: iataCode,
                color: color,
                endLat: endLat,
                endLng: endLng
            };

            // 3. Adiciona aos dados e atualiza a tabela
            destinations.push(newDestination);
            renderTable();

            // 4. Feedback e limpeza
            showMessage(`Destino "${cityName} (${iataCode})" adicionado com sucesso!`, false);
            document.getElementById('addDestinationForm').reset();
            document.getElementById('color').value = '#F97316'; // Define a cor padrão
        }

        // --- Funções de Eliminação ---

        // Abre o modal de confirmação
        function handleDeleteClick(event) {
            const button = event.target;
            destinationIdToDelete = parseInt(button.dataset.id);
            const destinationName = button.dataset.name;

            document.getElementById('modalDestinationName').textContent = destinationName;
            document.getElementById('deleteModal').style.display = 'flex';
        }

        // Fecha o modal
        function closeModal() {
            document.getElementById('deleteModal').style.display = 'none';
            destinationIdToDelete = null; // Limpa o ID em espera
        }

        // Confirma e executa a eliminação
        function confirmDelete() {
            if (destinationIdToDelete === null) return;

            const indexToRemove = destinations.findIndex(dest => dest.id === destinationIdToDelete);

            if (indexToRemove !== -1) {
                const deletedName = destinations[indexToRemove].name;
                // Remove o destino do array
                destinations.splice(indexToRemove, 1);
                
                // Redesenha a tabela
                renderTable();

                // Feedback
                showMessage(`Destino "${deletedName}" eliminado com sucesso.`, true); // Usar cor vermelha para eliminação
            }
            
            closeModal();
        }

        window.onload = function() {
            // Desenha a tabela inicial com os dados existentes
            renderTable();

            // Adiciona listeners de evento
            document.getElementById('addDestinationForm').addEventListener('submit', handleAddDestination);
            document.getElementById('cancelDeleteBtn').addEventListener('click', closeModal);
            document.getElementById('confirmDeleteBtn').addEventListener('click', confirmDelete);
        };
    </script>
</body>
</html>
