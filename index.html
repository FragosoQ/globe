<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Globo Responsivo - Capitais</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            /* Fundo da P√°gina (Web): Gradiente suave que se harmoniza com a cena 3D */
            background: radial-gradient(circle at center, #1a2330 0%, #0d1217 100%);
        }
        #globeViz {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
        #logo {
            position: absolute; /* Superior Esquerdo */
            top: 30px;
            left: 30px;
            width: 250px;
            height: auto;
            z-index: 10;
            border-radius: 5px;
        }
        #logo2 {
            position: absolute; /* Superior Direito */
            top: 30px;
            right: 30px;
            width: 200px;
            height: auto;
            z-index: 10;
            border-radius: 5px;
        }
        #logo3 {
            position: absolute; /* Inferior Direito */
            bottom: 30px;
            right: 30px;
            width: 150px;
            height: auto;
            z-index: 10;
            border-radius: 5px;
        }

        /* --- Estilos para o Toggle Button --- */
        #toggle-container {
            position: absolute;
            top: 30px; /* Alinhamento com os logos */
            left: 50%;
            transform: translateX(-50%); /* Centraliza horizontalmente */
            z-index: 20; /* Garante que est√° sobre o globo */
            background-color: #222; /* Fundo do container (Preto n√£o totalmente preto) */
            border-radius: 20px;
            padding: 5px;
            display: flex;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            width: auto; /* Adapta-se ao conte√∫do */
        }

        .toggle-btn {
            position: relative;
            z-index: 1;
            padding: 8px 15px;
            cursor: pointer;
            color: #000000; /* Cor do texto n√£o-ativo */
            font-weight: bold;
            font-family: Arial, sans-serif;
            transition: color 0.3s ease;
            
            /* FOR√áAR CENTRALIZA√á√ÉO DO TEXTO DENTRO DO BOT√ÉO */
            display: flex; 
            justify-content: center; /* Centraliza horizontalmente */
            align-items: center; /* Centraliza verticalmente */
            min-width: 140px; /* Garante que ambos os textos tenham largura suficiente */
        }

        .toggle-btn:hover {
            color: #fff;
        }

        .toggle-input {
            display: none; /* Esconde o radio button nativo */
        }

        /* O fundo cinza (ativo) √© aplicado ao span .toggle-slider */
        #daily-report:checked ~ .toggle-slider {
            transform: translateX(0);
        }

        #connected-machines:checked ~ .toggle-slider {
            transform: translateX(100%); 
        }

        .toggle-slider {
            position: absolute;
            top: 5px;
            left: 5px;
            height: calc(100% - 10px);
            width: calc(50% - 5px); /* Metade do container menos o padding do container */
            background-color: #777; /* Cinza ativado */
            border-radius: 20px;
            transition: transform 0.3s ease;
            z-index: 0;
            pointer-events: none; /* Garante que n√£o interfere no clique do label */
        }

        /* Cores do texto quando ATIVO (sobre o cinza) */
        #daily-report:checked + .toggle-btn-label {
            color: #000; 
            z-index: 1;
        }

        #connected-machines:checked + .toggle-btn-label {
            color: #000; 
            z-index: 1;
        }

        /* --- Estilos para a Caixa de Informa√ß√£o de Equipamentos (Direita) --- */
        #info-box {
            position: absolute;
            top: 50%; /* Centraliza verticalmente */
            right: 15%; /* Dist√¢ncia da margem direita */
            transform: translateY(-50%); /* Ajuste para centraliza√ß√£o vertical exata */
            z-index: 15; /* Acima do globo, abaixo dos logos */
            /*background-color: rgba(0, 0, 0, 0.6); /* Fundo preto semi-transparente */
            border-radius: 10px;
            padding: 20px;
            color: #fff;
            text-align: center;
            font-family: Arial, sans-serif;
            width: 180px; /* Largura fixa para a caixa */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
        }

        #info-box .number {
            font-size: 3em; /* Tamanho grande para o n√∫mero */
            font-weight: bold;
            color: #ffffff; /* Cor azul para destaque */
            line-height: 1; /* Garante espa√ßamento adequado */
            margin-bottom: 5px;
        }

        #info-box .label {
            font-size: 1.2em;
            color: #ffffff;
        }
        
        /* --- Estilos para o Card do Gr√°fico de Pizza (Esquerda) --- */
        #pie-chart-card {
            position: absolute;
            top: 50%; /* Centraliza verticalmente */
            left: 10%; /* Dist√¢ncia da margem esquerda */
            transform: translateY(-50%); /* Ajuste para centraliza√ß√£o vertical exata */
            z-index: 15;
            /*background-color: rgba(34, 34, 34, 0.8); /* Fundo escuro semi-transparente */
            border-radius: 10px;
            padding: 15px; /* Reduzido o padding */
            color: #fff;
            font-family: Arial, sans-serif;
            width: 200px; /* Largura reduzida */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #pie-chart-card h2 {
            font-size: 1.2em; /* Reduzido o t√≠tulo */
            margin-bottom: 10px;
            color: #f5f5f5; /* Cor tem√°tica */
        }
        
        /* Contenedor do Canvas para controlar o tamanho */
        #canvas-container {
            width: 150px; /* Tamanho fixo para o gr√°fico */
            height: 150px;
            margin-bottom: 15px;
        }

        /* Lista de detalhes por baixo do gr√°fico */
        #chart-details {
            list-style: none;
            padding: 0;
            margin: 0;
            width: 100%;
            text-align: left;
            font-size: 0.9em;
        }

        #chart-details li {
            padding: 4px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center; /* Alinha o texto e o swatch verticalmente */
            justify-content: space-between;
        }
        
        /* Estilo para o Quadrado de Cor */
        .color-swatch {
            display: inline-block;
            width: 12px;
            height: 12px;
            margin-right: 8px;
            border-radius: 2px;
            border: 1px solid rgba(255, 255, 255, 0.3); /* Borda suave */
            /* Usamos flexbox para controlar o posicionamento dentro do <li> */
            flex-shrink: 0; 
        }
        
        .label-text {
            /* Permite que o texto MWS... ocupe o espa√ßo restante */
            flex-grow: 1;
        }

        .chart-percentage {
            font-weight: bold;
            flex-shrink: 0; /* Impede que a percentagem encolha */
        }


        #chart-details li:last-child {
            border-bottom: none;
        }
    </style>

    <script type="importmap">
        {
            "imports": {
                "three": "https://esm.sh/three",
                "three/": "https://esm.sh/three/"
            }
        }
    </script>
</head>

<body>
    <div id="toggle-container">
        <input type="radio" id="daily-report" name="report-type" class="toggle-input" checked>
        <label for="daily-report" class="toggle-btn toggle-btn-label">Daily Report</label>

        <input type="radio" id="connected-machines" name="report-type" class="toggle-input">
        <label for="connected-machines" class="toggle-btn toggle-btn-label">Connected Machines</label>

        <span class="toggle-slider"></span>
    </div>

    <div id="info-box">
        <div class="number">304</div>
        <div class="label">Equipments</div>
        <div class="label">Connected</div>
    </div>
    
    <!-- CARD DO GR√ÅFICO DE PIZZA -->
    <div id="pie-chart-card">
        <h2>Equipments</h2>
        <div id="canvas-container">
            <canvas id="machineChart"></canvas>
        </div>
        
        <!-- Lista de detalhes por baixo do gr√°fico COM SWATCHES -->
        <ul id="chart-details">
            <!-- 1. MWS300 (Cinza M√©dio: #808080) -->
            <li><span class="color-swatch" style="background-color: #808080;"></span> <span class="label-text">MWS300</span> <span class="chart-percentage">30%</span></li>
            <!-- 2. MWS500 (Cinza Claro: #D3D3D3) -->
            <li><span class="color-swatch" style="background-color: #D3D3D3;"></span> <span class="label-text">MWS500</span> <span class="chart-percentage">50%</span></li>
            <!-- 3. MWS700 (Branco: #FFFFFF) -->
            <li><span class="color-swatch" style="background-color: #FFFFFF;"></span> <span class="label-text">MWS700</span> <span class="chart-percentage">30%</span></li>
            <!-- 4. MWS715 (Cinza Escuro: #505050) -->
            <li><span class="color-swatch" style="background-color: #505050;"></span> <span class="label-text">MWS715</span> <span class="chart-percentage">20%</span></li>
        </ul>
    </div>

    <div id="globeViz"></div>
    <img id="logo" src="https://static.wixstatic.com/media/a6967f_b1478a338afc4870879e1ba83f915dc5~mv2.png" alt="Logo Multiwasher">
    <img id="logo2" src="https://static.wixstatic.com/media/a6967f_691cf1aade3c471c816d1071b0c6ebdd~mv2.png" alt="Logo Somengil">
    <!--<img id="logo3" src="https://static.wixstatic.com/media/a6967f_e14aa13d109a43c68d9f6b2730aa23b2~mv2.png" alt="Logo Somengil">-->

    <script type="module">
        import ThreeGlobe from 'https://esm.sh/three-globe?external=three';
        import * as THREE from 'three';
        import { TrackballControls } from 'https://esm.sh/three/examples/jsm/controls/TrackballControls.js';

        // --- Dados de arcos (todas as capitais a partir de Lisboa), com nomes em Ingl√™s ---
       const arcsData = [
        // [START_LAT, START_LNG, END_LAT, END_LNG, SIGLA_PA√çS, COLOR]
        // --- Africa ---
        { startLat: 38.7223, startLng: -9.1393, endLat: -8.8383, endLng: 13.2344, name: 'AO', color: '#50B6E8' }, // Angola (Luanda)
        { startLat: 38.7223, startLng: -9.1393, endLat: 14.9315, endLng: -23.5363, name: 'CV', color: '#50B6E8' }, // Cabo Verde (Praia)
        { startLat: 38.7223, startLng: -9.1393, endLat: 30.0444, endLng: 31.2357, name: 'EG', color: '#50B6E8' }, // Egito (Cairo)
        { startLat: 38.7223, startLng: -9.1393, endLat: 32.8872, endLng: 13.5132, name: 'LY', color: '#50B6E8' }, // L√≠bia (Tripoli)
        { startLat: 38.7223, startLng: -9.1393, endLat: -25.9653, endLng: 32.5892, name: 'MZ', color: '#50B6E8' }, // Mo√ßambique (Maputo)
        { startLat: 38.7223, startLng: -9.1393, endLat: 0.3366, endLng: 6.7335, name: 'ST', color: '#50B6E8' }, // S√£o Tom√© e Pr√≠ncipe (Sao Tome)

        // --- Americas ---
        { startLat: 38.7223, startLng: -9.1393, endLat: -34.6037, endLng: -58.3816, name: 'AR', color: '#50B6E8' }, // Argentina (Buenos Aires)
        { startLat: 38.7223, startLng: -9.1393, endLat: -15.7942, endLng: -47.8825, name: 'BR', color: '#50B6E8' }, // Brasil (Brasilia)
        { startLat: 38.7223, startLng: -9.1393, endLat: 45.4215, endLng: -75.6972, name: 'CA', color: '#50B6E8' }, // Canad√° (Ottawa)
        { startLat: 38.7223, startLng: -9.1393, endLat: -33.4489, endLng: -70.6693, name: 'CL', color: '#50B6E8' }, // Chile (Santiago)
        { startLat: 38.7223, startLng: -9.1393, endLat: 4.7110, endLng: -74.0721, name: 'CO', color: '#50B6E8' }, // Col√¥mbia (Bogota)
        { startLat: 38.7223, startLng: -9.1393, endLat: 18.4861, endLng: -69.9308, name: 'DO', color: '#50B6E8' }, // Rep√∫blica Dominicana (Santo Domingo)
        { startLat: 38.7223, startLng: -9.1393, endLat: 13.6929, endLng: -89.2182, name: 'SV', color: '#50B6E8' }, // El Salvador (San Salvador)
        { startLat: 38.7223, startLng: -9.1393, endLat: 14.6349, endLng: -90.5069, name: 'GT', color: '#50B6E8' }, // Guatemala (Guatemala City)
        { startLat: 38.7223, startLng: -9.1393, endLat: 14.0820, endLng: -87.2068, name: 'HN', color: '#50B6E8' }, // Honduras (Tegucigalpa)
        { startLat: 38.7223, startLng: -9.1393, endLat: 19.4326, endLng: -99.1332, name: 'MX', color: '#50B6E8' }, // M√©xico (Mexico City)
        { startLat: 38.7223, startLng: -9.1393, endLat: 8.9828, endLng: -79.5199, name: 'PA', color: '#50B6E8' }, // Panam√° (Panama City)
        { startLat: 38.7223, startLng: -9.1393, endLat: -12.0464, endLng: -77.0428, name: 'PE', color: '#50B6E8' }, // Peru (Lima)
        { startLat: 38.7223, startLng: -9.1393, endLat: 38.9072, endLng: -77.0369, name: 'US', color: '#50B6E8' }, // Estados Unidos (Washington D.C.)

        // --- Asia and Middle East ---
        { startLat: 38.7223, startLng: -9.1393, endLat: 24.6333, endLng: 46.7167, name: 'SA', color: '#50B6E8' }, // Ar√°bia Saudita (Riyadh)
        { startLat: 38.7223, startLng: -9.1393, endLat: 39.9042, endLng: 116.4074, name: 'CN', color: '#50B6E8' }, // China (Beijing)
        { startLat: 38.7223, startLng: -9.1393, endLat: -6.2088, endLng: 106.8456, name: 'ID', color: '#50B6E8' }, // Indon√©sia (Jakarta)
        { startLat: 38.7223, startLng: -9.1393, endLat: 35.6892, endLng: 51.3890, name: 'IR', color: '#50B6E8' }, // Ir√£ (Tehran)
        { startLat: 38.7223, startLng: -9.1393, endLat: 31.7683, endLng: 35.2137, name: 'IL', color: '#50B6E8' }, // Israel (Jerusalem)
        { startLat: 38.7223, startLng: -9.1393, endLat: 31.9566, endLng: 35.9457, name: 'JO', color: '#50B6E8' }, // Jord√¢nia (Amman)
        { startLat: 38.7223, startLng: -9.1393, endLat: 37.5665, endLng: 126.9780, name: 'KR', color: '#50B6E8' }, // Coreia do Sul (Seoul)
        { startLat: 38.7223, startLng: -9.1393, endLat: 29.3786, endLng: 47.9903, name: 'KW', color: '#50B6E8' }, // Kuwait (Kuwait City)
        { startLat: 38.7223, startLng: -9.1393, endLat: 33.8938, endLng: 35.5018, name: 'LB', color: '#50B6E8' }, // L√≠bano (Beirut)
        { startLat: 38.7223, startLng: -9.1393, endLat: 47.8864, endLng: 106.9057, name: 'MN', color: '#50B6E8' }, // Mong√≥lia (Ulaanbaatar)
        { startLat: 38.7223, startLng: -9.1393, endLat: 14.5995, endLng: 120.9842, name: 'PH', color: '#50B6E8' }, // Filipinas (Manila)
        { startLat: 38.7223, startLng: -9.1393, endLat: 25.3548, endLng: 51.1839, name: 'QA', color: '#50B6E8' }, // Catar (Doha)
        { startLat: 38.7223, startLng: -9.1393, endLat: 25.0330, endLng: 121.5654, name: 'TW', color: '#50B6E8' }, // Taiwan (Taipei)
        { startLat: 38.7223, startLng: -9.1393, endLat: 24.4539, endLng: 54.3773, name: 'AE', color: '#50B6E8' }, // Emirados √Årabes Unidos (Abu Dhabi)
        { startLat: 38.7223, startLng: -9.1393, endLat: 41.2665, endLng: 69.2162, name: 'UZ', color: '#50B6E8' }, // Uzbequist√£o (Tashkent)

        // --- Europe and Oceania ---
        { startLat: 38.7223, startLng: -9.1393, endLat: -35.2809, endLng: 149.1300, name: 'AU', color: '#50B6E8' }, // Austr√°lia (Canberra)
        { startLat: 38.7223, startLng: -9.1393, endLat: 48.2082, endLng: 16.3738, name: 'AT', color: '#50B6E8' }, // √Åustria (Vienna)
        { startLat: 38.7223, startLng: -9.1393, endLat: 50.8503, endLng: 4.3517, name: 'BE', color: '#50B6E8' }, // B√©lgica (Brussels)
        { startLat: 38.7223, startLng: -9.1393, endLat: 45.8150, endLng: 15.9819, name: 'HR', color: '#50B6E8' }, // Cro√°cia (Zagreb)
        { startLat: 38.7223, startLng: -9.1393, endLat: 35.1856, endLng: 33.3823, name: 'CY', color: '#50B6E8' }, // Chipre (Nicosia)
        { startLat: 38.7223, startLng: -9.1393, endLat: 55.6761, endLng: 12.5683, name: 'DK', color: '#50B6E8' }, // Dinamarca (Copenhagen)
        { startLat: 38.7223, startLng: -9.1393, endLat: 40.4168, endLng: -3.7038, name: 'ES', color: '#50B6E8' }, // Espanha (Madrid)
        { startLat: 38.7223, startLng: -9.1393, endLat: 59.4370, endLng: 24.7536, name: 'EE', color: '#50B6E8' }, // Est√≥nia (Tallinn)
        { startLat: 38.7223, startLng: -9.1393, endLat: 60.1699, endLng: 24.9384, name: 'FI', color: '#50B6E8' }, // Finl√¢ndia (Helsinki)
        { startLat: 38.7223, startLng: -9.1393, endLat: 48.8566, endLng: 2.3522, name: 'FR', color: '#50B6E8' }, // Fran√ßa (Paris)
        { startLat: 38.7223, startLng: -9.1393, endLat: 52.5200, endLng: 13.4050, name: 'DE', color: '#50B6E8' }, // Alemanha (Berlin)
        { startLat: 38.7223, startLng: -9.1393, endLat: 37.9838, endLng: 23.7275, name: 'GR', color: '#50B6E8' }, // Gr√©cia (Athens)
        { startLat: 38.7223, startLng: -9.1393, endLat: 47.4979, endLng: 19.0402, name: 'HU', color: '#50B6E8' }, // Hungria (Budapest)
        { startLat: 38.7223, startLng: -9.1393, endLat: 41.9028, endLng: 12.4964, name: 'IT', color: '#50B6E8' }, // It√°lia (Rome)
        { startLat: 38.7223, startLng: -9.1393, endLat: 54.6872, endLng: 25.2797, name: 'LT', color: '#50B6E8' }, // Litu√¢nia (Vilnius)
        { startLat: 38.7223, startLng: -9.1393, endLat: 49.6116, endLng: 6.1319, name: 'LU', color: '#50B6E8' }, // Luxemburgo (Luxembourg)
        { startLat: 38.7223, startLng: -9.1393, endLat: 52.3676, endLng: 4.9041, name: 'NL', color: '#50B6E8' }, // Holanda (Amsterdam)
        { startLat: 38.7223, startLng: -9.1393, endLat: 54.7000, endLng: -6.0000, name: 'GB', color: '#50B6E8' }, // Reino Unido (Belfast) (Usando GB, embora NI seja UK/GB)
        { startLat: 38.7223, startLng: -9.1393, endLat: 59.9139, endLng: 10.7522, name: 'NO', color: '#50B6E8' }, // Noruega (Oslo)
        { startLat: 38.7223, startLng: -9.1393, endLat: 52.2297, endLng: 21.0122, name: 'PL', color: '#50B6E8' }, // Pol√≥nia (Warsaw)
        { startLat: 38.7223, startLng: -9.1393, endLat: 38.7223, endLng: -9.1393, name: 'PT', color: '#50B6E8' }, // Portugal (Lisbon, the starting point)
        { startLat: 38.7223, startLng: -9.1393, endLat: 53.9045, endLng: 27.5615, name: 'BY', color: '#50B6E8' }, // Bielorr√∫ssia (Minsk)
        { startLat: 38.7223, startLng: -9.1393, endLat: 44.4268, endLng: 26.1025, name: 'RO', color: '#50B6E8' }, // Rom√©nia (Bucharest)
        { startLat: 38.7223, startLng: -9.1393, endLat: 55.7558, endLng: 37.6173, name: 'RU', color: '#50B6E8' }, // R√∫ssia (Moscow)
        { startLat: 38.7223, startLng: -9.1393, endLat: 48.1486, endLng: 17.1077, name: 'SK', color: '#50B6E8' }, // Eslov√°quia (Bratislava)
        { startLat: 38.7223, startLng: -9.1393, endLat: 46.0569, endLng: 14.5058, name: 'SI', color: '#50B6E8' }, // Eslov√©nia (Ljubljana)
        { startLat: 38.7223, startLng: -9.1393, endLat: 59.3293, endLng: 18.0686, name: 'SE', color: '#50B6E8' }, // Su√©cia (Stockholm)
        { startLat: 38.7223, startLng: -9.1393, endLat: 46.8182, endLng: 8.2275, name: 'CH', color: '#50B6E8' }, // Su√≠√ßa (Bern)
        { startLat: 38.7223, startLng: -9.1393, endLat: 51.5074, endLng: -0.1278, name: 'GB', color: '#50B6E8' }, // Reino Unido (London)
        { startLat: 38.7223, startLng: -9.1393, endLat: 50.0755, endLng: 14.4378, name: 'CZ', color: '#50B6E8' } // Ch√©quia (Prague)
        ];

        // 1. --- Preparar os Dados dos Pontos ---
        const pointsData = arcsData.map(d => ({
            lat: d.endLat,
            lng: d.endLng,
            size: d.name === 'Lisbon' ? 0.25 : 0.2, // Ligeiramente maior para a origem
            color: d.name === 'Lisbon' ? '#FFFFFF' : '#0058E8' // Branca para a origem, Azul escuro para as capitais
        }));

        // 2. --- Preparar os Dados dos R√≥tulos (Labels) ---
       const labelsData = arcsData.map(d => ({
          lat: d.endLat,
          lng: d.endLng,
          text: d.name,
          size: 0.001,
          color: 'gray',
          fontFace: 'Arial',
          labelDotRadius: 0.001,
          // Adicionando borda ao texto (se suportado)
          strokeColor: '#000000', // cor do contorno
          strokeWidth: 0.0005 // espessura do contorno
       }));

        // --- Globo ---
        const Globe = new ThreeGlobe()
            .globeImageUrl('https://static.wixstatic.com/media/a6967f_42a4ffc4e3ba400385f034cb154d8cbd~mv2.png')
            .bumpImageUrl('//cdn.jsdelivr.net/npm/three-globe/example/img/earth-topology.png')
            .arcsData(arcsData)
            .arcColor('color')
            .arcDashLength(0.4)
            .arcDashGap(4)
            .arcDashInitialGap(() => Math.random() * 5)
            .arcDashAnimateTime(1000)
            
            // 3. --- Configura√ß√£o dos Pontos ---
            .pointsData(pointsData)
            .pointAltitude(0.01) // Altura do ponto (se zero, fica na superf√≠cie)
            .pointColor('color') // Cor do ponto
            .pointRadius(0.6) // Raio do ponto (controla o tamanho visual no ecr√£)
            
            // 4. --- Configura√ß√£o dos R√≥tulos (Labels) ---
            .labelsData(labelsData)
            .labelColor('color') // Cor do texto do r√≥tulo (branco)
            .labelAltitude(0.01) // Coloca o r√≥tulo ligeiramente acima da superf√≠cie
            .labelSize('size') // Tamanho do r√≥tulo
            .labelDotRadius('labelDotRadius') // Raio do ponto de conex√£o
            .labelText('text') // O campo a usar para o texto
            .labelResolution(3); // Aumenta a resolu√ß√£o do texto para melhor qualidade
            

        // --- Renderer ---
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setPixelRatio(Math.min(2, window.devicePixelRatio));
        document.getElementById('globeViz').appendChild(renderer.domElement);

        // --- Cena e luzes ---
        const scene = new THREE.Scene();
        // ‚úÖ DEFINI√á√ÉO DA COR DE FUNDO DA CENA 3D (Three.js)
        
        // Isto garante que o fundo √© consistentemente escuro se o CSS for ignorado.
        scene.background = new THREE.Color(0x0a101d); 
        
        scene.add(Globe);
        scene.add(new THREE.AmbientLight(0xffffff, Math.PI));
        scene.add(new THREE.DirectionalLight(0xf5f5f5, 4 * Math.PI));

        // --- C√¢mara ---
        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        
        // üìå POSI√á√ÉO DA C√ÇMARA (Vista Superior Deslocada)
        camera.position.x = -50; // Move a c√¢mara ligeiramente para a esquerda
        camera.position.y = 200;  // Move a c√¢mara para cima (vista superior)
        camera.position.z = 350; // Zoom mais perto (Ajustado para melhor vista)
        
        // 1. Rota√ß√£o da C√ÇMARA: Inclinar a vista em 20 graus para baixo no eixo X
        camera.rotation.x = THREE.MathUtils.degToRad(20);
        
        // ** ROTA√á√ÉO DO GLOBO (Centra o foco em Portugal: 38.72¬∫ N, -9.14¬∫ W) **
        // Latitude (N/S): -38.72 (negativo da latitude)
        Globe.rotation.x = THREE.MathUtils.degToRad(-38.7223); 
        // 2. Longitude (E/O): +9.14 (negativo da longitude -9.14)
        Globe.rotation.y = THREE.MathUtils.degToRad(9.1393);
        
        // --- Controlos ---
        const tbControls = new TrackballControls(camera, renderer.domElement);
        tbControls.minDistance = 101;
        tbControls.rotateSpeed = 5;
        tbControls.zoomSpeed = 0.8;

        // --- Resize Responsivo ---
        function onWindowResize() {
            const width = window.innerWidth;
            const height = window.innerHeight;
            renderer.setSize(width, height);
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
        }

        window.addEventListener('resize', onWindowResize);
        onWindowResize();

        // --- Rota√ß√£o autom√°tica ---
        const ROTATE_SPEED = -0.005;

        // --- Inicializa√ß√£o do Gr√°fico de Pizza (Pie Chart) ---
        function initializeChart() {
            const ctx = document.getElementById('machineChart').getContext('2d');
            
            // Dados fornecidos: MWS300: 30, MWS500: 50, MWS700: 30, MWS715: 20
            const machineData = {
                labels: ['MWS300', 'MWS500', 'MWS700', 'MWS715'],
                datasets: [{
                    data: [30, 50, 30, 20], 
                    // üö® Paleta estritamente Cinzento e Branco com OPACIDADE (Alpha=0.8)
                    backgroundColor: [
                        'rgba(128, 128, 128, 0.8)', // Cinzento M√©dio (#808080)
                        'rgba(211, 211, 211, 0.8)', // Cinzento Claro (#D3D3D3)
                        'rgba(255, 255, 255, 0.8)', // Branco (#FFFFFF)
                        'rgba(80, 80, 80, 0.8)'    // Cinzento Escuro (#505050)
                    ],
                    // Paleta de HOVER (Alpha=1.0 para manter o contraste na intera√ß√£o)
                    hoverBackgroundColor: [
                        'rgba(153, 153, 153, 1.0)',
                        'rgba(255, 255, 255, 1.0)',
                        'rgba(204, 204, 204, 1.0)',
                        'rgba(102, 102, 102, 1.0)'
                    ],
                    borderColor: 'rgba(255, 255, 255, 0.2)', // Borda suave
                    borderWidth: 1
                }]
            };

            const config = {
                type: 'pie',
                data: machineData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        // Legenda removida para minimalismo
                        legend: {
                            display: false
                        },
                        tooltip: {
                             // Tooltip mantido para interatividade
                             callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed !== null) {
                                        const total = context.chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
                                        const value = context.parsed;
                                        // Calcula e exibe a percentagem real
                                        const percentage = ((value / total) * 100).toFixed(1);
                                        label += percentage + '%';
                                    }
                                    return label;
                                }
                            },
                            bodyColor: '#333',
                            titleColor: '#333',
                            backgroundColor: 'rgba(255, 255, 255, 0.9)', // Fundo claro para contraste
                            borderColor: '#888',
                            borderWidth: 1
                        },
                        title: {
                            display: false
                        }
                    }
                }
            };

            new Chart(ctx, config);
        }

        // --- Loop de anima√ß√£o ---
        function animate() {
            requestAnimationFrame(animate);
            // Rota√ß√£o principal no eixo Y
            Globe.rotation.y += ROTATE_SPEED;
            
            tbControls.update();
            renderer.render(scene, camera);
        }

        animate();
        initializeChart();
    </script>
</body>
</html>
