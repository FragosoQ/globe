<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Globo Responsivo - Capitais</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            /* Fundo da P√°gina (Web): Gradiente suave que se harmoniza com a cena 3D */
            background: radial-gradient(circle at center, #191722 0.5%, #000000 100%);
        }
        #globeViz {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
        #logo {
            position: absolute; /* Superior Esquerdo */
            top: 30px;
            left: 30px;
            width: 250px;
            height: auto;
            z-index: 10;
            border-radius: 5px;
        }
        #logo2 {
            position: absolute; /* Superior Direito */
            top: 30px;
            right: 30px;
            width: 200px;
            height: auto;
            z-index: 10;
            border-radius: 5px;
        }
        #logo3 {
            position: absolute; /* Inferior Direito */
            bottom: 30px;
            right: 30px;
            width: 150px;
            height: auto;
            z-index: 10;
            border-radius: 5px;
        }

        /* --- Estilos para o Toggle Button --- */
        #toggle-container {
            position: absolute;
            top: 30px; /* Alinhamento com os logos */
            left: 50%;
            transform: translateX(-50%); /* Centraliza horizontalmente */
            z-index: 20; /* Garante que est√° sobre o globo */
            background-color: #222; /* Fundo do container (Preto n√£o totalmente preto) */
            border-radius: 20px;
            padding: 5px;
            display: flex;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            width: auto; /* Adapta-se ao conte√∫do */
        }

        .toggle-btn {
            position: relative;
            z-index: 1;
            padding: 8px 15px;
            cursor: pointer;
            color: #000000; /* Cor do texto n√£o-ativo */
            font-weight: bold;
            font-family: Arial, sans-serif;
            transition: color 0.3s ease;
            
            /* FOR√áAR CENTRALIZA√á√ÉO DO TEXTO DENTRO DO BOT√ÉO */
            display: flex; 
            justify-content: center; /* Centraliza horizontalmente */
            align-items: center; /* Centraliza verticalmente */
            min-width: 140px; /* Garante que ambos os textos tenham largura suficiente */
        }

        .toggle-btn:hover {
            color: #fff;
        }

        .toggle-input {
            display: none; /* Esconde o radio button nativo */
        }

        /* O fundo cinza (ativo) √© aplicado ao span .toggle-slider */
        #daily-report:checked ~ .toggle-slider {
            transform: translateX(0);
        }

        #connected-machines:checked ~ .toggle-slider {
            transform: translateX(100%); 
        }

        .toggle-slider {
            position: absolute;
            top: 5px;
            left: 5px;
            height: calc(100% - 10px);
            width: calc(50% - 5px); /* Metade do container menos o padding do container */
            background-color: #777; /* Cinza ativado */
            border-radius: 20px;
            transition: transform 0.3s ease;
            z-index: 0;
            pointer-events: none; /* Garante que n√£o interfere no clique do label */
        }

        /* Cores do texto quando ATIVO (sobre o cinza) */
        #daily-report:checked + .toggle-btn-label {
            color: #000; 
            z-index: 1;
        }

        #connected-machines:checked + .toggle-btn-label {
            color: #000; 
            z-index: 1;
        }

        /* --- Estilos para a Caixa de Informa√ß√£o de Equipamentos (Direita) --- */
        #info-box {
            position: absolute;
            top: 50%; /* Centraliza verticalmente */
            right: 15%; /* Dist√¢ncia da margem direita */
            transform: translateY(-50%); /* Ajuste para centraliza√ß√£o vertical exata */
            z-index: 15; /* Acima do globo, abaixo dos logos */
            /*background-color: rgba(0, 0, 0, 0.6); /* Fundo preto semi-transparente */*/
            /*border-radius: 10px;*/
            padding: 20px;
            color: #fff;
            text-align: center;
            font-family: Arial, sans-serif;
            width: 180px; /* Largura fixa para a caixa */
            /*box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);*/
        }

        #info-box .number {
            font-size: 3em; /* Tamanho grande para o n√∫mero */
            font-weight: bold;
            color: #ffffff; /* Cor azul para destaque */
            line-height: 1; /* Garante espa√ßamento adequado */
            margin-bottom: 5px;
        }

        #info-box .label {
            font-size: 1.2em;
            color: #ffffff;
        }
        
        /* --- Estilos para o Card do Gr√°fico de Pizza (Esquerda) --- */
        #pie-chart-card {
            position: absolute;
            bottom: 80px;
            left: 5%;
            /*transform: translateY(-50%);*/
            z-index: 15;
            border-radius: 10px;
            padding: 15px;
            color: #fff;
            font-family: Arial, sans-serif;
            width: 350px; /* maior para acomodar layout lado a lado */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.7);
            display: flex; /* layout em linha */
            flex-direction: row; /* lado a lado */
            align-items: center;
            background: transparent; /* opcional, se desejar */
        }

        #pie-chart-card h2 {
            font-size: 1.2em; /* Reduzido o t√≠tulo */
            margin-bottom: 10px;
            color: #f5f5f5; /* Cor tem√°tica */
        }
        
/* Tamanho do Canvas */
#canvas-container {
    width: 250px;
    height: 150px;
    margin-right: 20px; /* espa√ßamento entre gr√°fico e legenda */
}

/* Legenda */
#legend {
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    width: 20px; /* ajuste conforme necess√°rio */
}
#legend h2 {
    margin: 0 0 10px 0;
    font-size: 1.2em;
    color: #f5f5f5;
}

/* Lista de detalhes na legenda */
#chart-details {
    list-style: none;
    padding: 0;
    margin: 0;
    width: 100%;
    font-size: 0.9em;
}
#chart-details li {
    padding: 4px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    align-items: center;
    justify-content: space-between;
}
        
        /* Wrapper que envolve gr√°fico e legenda */
#pie-chart-wrapper {
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: start;
    width: 100%;
}
        
        /* Estilo para o Quadrado de Cor */
        .color-swatch {
            display: inline-block;
            width: 12px;
            height: 12px;
            margin-right: 8px;
            border-radius: 2px;
            border: 1px solid rgba(255, 255, 255, 0.3); /* Borda suave */
            /* Usamos flexbox para controlar o posicionamento dentro do <li> */
            flex-shrink: 0; 
        }
        
        .label-text {
            /* Permite que o texto MWS... ocupe o espa√ßo restante */
            flex-grow: 1;
        }

        .chart-percentage {
            font-weight: bold;
            flex-shrink: 0; /* Impede que a percentagem encolha */
        }


        #chart-details li:last-child {
            border-bottom: none;
        }
        
        /* --- NOVO CSS PARA O BOT√ÉO PLAY/PAUSE (N√£o altera estilos existentes) --- */
        #play-pause-container {
            position: absolute;
            bottom: 30px; 
            left: 5%;
            /*transform: translateX(-50%); /* Centraliza abaixo */
            z-index: 20;
        }

        #playPauseBtn {
            padding: 10px 20px;
            background-color: rgba(222, 214, 213,0.1); /* Azul */
            color: gray;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-family: Arial, sans-serif;
            transition: background-color 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        #playPauseBtn:hover {
            background-color: ;
        }
        /* FIM DO NOVO CSS */
    </style>

    <script type="importmap">
        {
            "imports": {
                "three": "https://esm.sh/three",
                "three/": "https://esm.sh/three/"
            }
        }
    </script>
</head>

<body>
    <div id="toggle-container">
        <input type="radio" id="daily-report" name="report-type" class="toggle-input" checked>
        <label for="daily-report" class="toggle-btn toggle-btn-label">Daily Report</label>

        <input type="radio" id="connected-machines" name="report-type" class="toggle-input">
        <label for="connected-machines" class="toggle-btn toggle-btn-label">Connected Machines</label>

        <span class="toggle-slider"></span>
    </div>

    <div id="info-box">
        <div class="number">364</div>
        <div class="label">Equipments</div>
        <div class="label">Connected</div>
    </div>
    
    <div id="pie-chart-card">
        <h2></h2>
        <div id="canvas-container">
            <canvas id="machineChart"></canvas>
        </div>
      
        <ul id="chart-details">
            <li><span class="color-swatch" style="background-color: #808080;"></span> <span class="label-text">EUROPA</span> <span class="chart-percentage">73.5%</span></li>
            <li><span class="color-swatch" style="background-color: #D3D3D3;"></span> <span class="label-text">AM√âRICA</span> <span class="chart-percentage">17.9%</span></li>
            <li><span class="color-swatch" style="background-color: #FFFFFF;"></span> <span class="label-text">√ÅFRICA</span> <span class="chart-percentage">0.5%</span></li>
            <li><span class="color-swatch" style="background-color: #505050;"></span> <span class="label-text">√ÅSIA</span> <span class="chart-percentage">7.1%</span></li>
            <li><span class="color-swatch" style="background-color: #312f31;"></span> <span class="label-text">OCE√ÇNIA</span> <span class="chart-percentage">1.0%</span></li>
        </ul>
    </div>
    
    <div id="play-pause-container">
        <button id="playPauseBtn"> Pausar Rota√ß√£o</button>
    </div>

    <div id="globeViz"></div>
    <img id="logo" src="https://static.wixstatic.com/media/a6967f_b1478a338afc4870879e1ba83f915dc5~mv2.png" alt="Logo Multiwasher">
    <img id="logo2" src="https://static.wixstatic.com/media/a6967f_691cf1aade3c471c816d1071b0c6ebdd~mv2.png" alt="Logo Somengil">
    <script type="module">
        import ThreeGlobe from 'https://esm.sh/three-globe?external=three';
        import * as THREE from 'three';
        import { TrackballControls } from 'https://esm.sh/three/examples/jsm/controls/TrackballControls.js';

        // --- Dados de arcos (todas as capitais a partir de Lisboa), com nomes em Ingl√™s ---
   const arcsData = [
  // üåç √Åfrica
  { startLat: 38.7223, startLng: -9.1393, endLat: -8.8383, endLng: 13.2344, name: 'LAD', color: '#50B6E8' }, // Angola (Luanda)
  { startLat: 38.7223, startLng: -9.1393, endLat: 0.4162, endLng: 9.4673, name: 'LBV', color: '#50B6E8' }, // Gabon (Libreville)
  { startLat: 38.7223, startLng: -9.1393, endLat: 32.8872, endLng: 13.5888, name: 'TIP', color: '#50B6E8' }, // L√≠bia (Tripoli)
  { startLat: 38.7223, startLng: -9.1393, endLat: 33.5731, endLng: -7.5898, name: 'CMN', color: '#50B6E8' }, // Marrocos (Casablanca)
  { startLat: 38.7223, startLng: -9.1393, endLat: -25.9653, endLng: 32.5832, name: 'MPM', color: '#50B6E8' }, // Mo√ßambique (Maputo)
  { startLat: 38.7223, startLng: -9.1393, endLat: 0.3366, endLng: 6.7325, name: 'TMS', color: '#50B6E8' }, // S√£o Tom√© e Pr√≠ncipe (S√£o Tom√©)
  { startLat: 38.7223, startLng: -9.1393, endLat: 30.0444, endLng: 31.2357, name: 'CAI', color: '#50B6E8' }, // Egito (Cairo)
  { startLat: 38.7223, startLng: -9.1393, endLat: 5.3600, endLng: -4.0083, name: 'ABJ', color: '#50B6E8' }, // Ivory (Abidjan)
  { startLat: 38.7223, startLng: -9.1393, endLat: 14.9213, endLng: -23.5085, name: 'RAI', color: '#50B6E8' }, // Cabo Verde (Praia)

  // üåé Am√©rica
  { startLat: 38.7223, startLng: -9.1393, endLat: -34.5997, endLng: -58.3819, name: 'BUE', color: '#50B6E8' }, // Argentina (Buenos Aires)
  { startLat: 38.7223, startLng: -9.1393, endLat: -15.7939, endLng: -47.8828, name: 'BSB', color: '#50B6E8' }, // Brasil (Bras√≠lia)
  { startLat: 38.7223, startLng: -9.1393, endLat: 45.4215, endLng: -75.6972, name: 'YOW', color: '#50B6E8' }, // Canad√° (Ottawa)
  { startLat: 38.7223, startLng: -9.1393, endLat: -33.4489, endLng: -70.6693, name: 'SCL', color: '#50B6E8' }, // CHILE (Santiago)
  { startLat: 38.7223, startLng: -9.1393, endLat: 4.7110, endLng: -74.0721, name: 'BOG', color: '#50B6E8' }, // Col√¥mbia (Bogot√°)
  { startLat: 38.7223, startLng: -9.1393, endLat: 18.4861, endLng: -69.9312, name: 'SDQ', color: '#50B6E8' }, // Dominican Republic (Santo Domingo)
  { startLat: 38.7223, startLng: -9.1393, endLat: 13.6929, endLng: -89.2182, name: 'SAL', color: '#50B6E8' }, // El Salvador (San Salvador)
  { startLat: 38.7223, startLng: -9.1393, endLat: 14.6349, endLng: -90.5069, name: 'GUA', color: '#50B6E8' }, // Guatemala (Cidade da Guatemala)
  { startLat: 38.7223, startLng: -9.1393, endLat: 14.0723, endLng: -87.2068, name: 'TGU', color: '#50B6E8' }, // Honduras (Tegucigalpa)
  { startLat: 38.7223, startLng: -9.1393, endLat: 19.4326, endLng: -99.1332, name: 'MEX', color: '#50B6E8' }, // M√©xico (Cidade do M√©xico)
  { startLat: 38.7223, startLng: -9.1393, endLat: 8.9824, endLng: -79.5199, name: 'PTY', color: '#50B6E8' }, // Panam√° (Cidade do Panam√°)
  { startLat: 38.7223, startLng: -9.1393, endLat: -12.0464, endLng: -77.0428, name: 'LIM', color: '#50B6E8' }, // Peru (Lima)
  { startLat: 38.7223, startLng: -9.1393, endLat: 40.6611, endLng: -73.9450, name: 'JFK', color: '#50B6E8' }, // United States (Nova Iorque)
  { startLat: 38.7223, startLng: -9.1393, endLat: 34.0522, endLng: -118.2437, name: 'LAX', color: '#50B6E8' }, // United States of America (Los Angeles)

  // üá™üá∫ Europa
  { startLat: 38.7223, startLng: -9.1393, endLat: 48.2084, endLng: 16.3738, name: 'VIE', color: '#50B6E8' }, // √Åustria (Viena)
  { startLat: 38.7223, startLng: -9.1393, endLat: 50.8471, endLng: 4.3661, name: 'BRU', color: '#50B6E8' }, // Belgium (Bruxelas)
  { startLat: 38.7223, startLng: -9.1393, endLat: 45.8150, endLng: 15.9819, name: 'ZAG', color: '#50B6E8' }, // Cro√°tia (Zagreb)
  { startLat: 38.7223, startLng: -9.1393, endLat: 35.1856, endLng: 33.3823, name: 'NIC', color: '#50B6E8' }, // Cyprus (Nic√≥sia)
  { startLat: 38.7223, startLng: -9.1393, endLat: 50.0755, endLng: 14.4378, name: 'PRG', color: '#50B6E8' }, // Czech Republic (Praga)
  { startLat: 38.7223, startLng: -9.1393, endLat: 55.6761, endLng: 12.5683, name: 'CPH', color: '#50B6E8' }, // Denmark (Copenhague)
  { startLat: 38.7223, startLng: -9.1393, endLat: 40.4169, endLng: -3.7034, name: 'MAD', color: '#50B6E8' }, // Espanha (Madrid)
  { startLat: 38.7223, startLng: -9.1393, endLat: 59.4370, endLng: 24.7536, name: 'TLL', color: '#50B6E8' }, // Est√≥nia (Tallinn)
  { startLat: 38.7223, startLng: -9.1393, endLat: 60.1695, endLng: 24.9355, name: 'HEL', color: '#50B6E8' }, // Finland (Helsinque)
  { startLat: 38.7223, startLng: -9.1393, endLat: 48.8567, endLng: 2.3522, name: 'CDG', color: '#50B6E8' }, // Fran√ßa (Paris)
  { startLat: 38.7223, startLng: -9.1393, endLat: 52.5167, endLng: 13.3833, name: 'BER', color: '#50B6E8' }, // Germany (Berlim)
  { startLat: 38.7223, startLng: -9.1393, endLat: 37.9838, endLng: 23.7275, name: 'ATH', color: '#50B6E8' }, // Greece (Atenas)
  { startLat: 38.7223, startLng: -9.1393, endLat: 47.4979, endLng: 19.0402, name: 'BUD', color: '#50B6E8' }, // Hungary (Budapeste)
  { startLat: 38.7223, startLng: -9.1393, endLat: 41.8933, endLng: 12.4828, name: 'FCO', color: '#50B6E8' }, // It√°lia (Roma)
  { startLat: 38.7223, startLng: -9.1393, endLat: 54.6872, endLng: 25.2797, name: 'VNO', color: '#50B6E8' }, // Lithuania (Vilnius)
  { startLat: 38.7223, startLng: -9.1393, endLat: 49.8153, endLng: 6.1296, name: 'LUX', color: '#50B6E8' }, // Luxemburgo (Luxemburgo)
  { startLat: 38.7223, startLng: -9.1393, endLat: 52.3702, endLng: 4.8952, name: 'AMS', color: '#50B6E8' }, // Netherlands (Amsterd√£)
  { startLat: 38.7223, startLng: -9.1393, endLat: 54.5973, endLng: -5.9301, name: 'BFS', color: '#50B6E8' }, // Northern Ireland (Belfast)
  { startLat: 38.7223, startLng: -9.1393, endLat: 59.9139, endLng: 10.7522, name: 'OSL', color: '#50B6E8' }, // Norway (Oslo)
  { startLat: 38.7223, startLng: -9.1393, endLat: 52.2322, endLng: 21.0122, name: 'WAW', color: '#50B6E8' }, // Poland (Vars√≥via)
  { startLat: 38.7223, startLng: -9.1393, endLat: 41.1496, endLng: -8.6109, name: 'OPO', color: '#50B6E8' }, // Portugal (Porto)
  { startLat: 38.7223, startLng: -9.1393, endLat: 53.9045, endLng: 27.5615, name: 'MSQ', color: '#50B6E8' }, // Republic of Belarus (Minsk)
  { startLat: 38.7223, startLng: -9.1393, endLat: 44.4268, endLng: 26.1025, name: 'OTP', color: '#50B6E8' }, // Romania (Bucareste)
  { startLat: 38.7223, startLng: -9.1393, endLat: 55.7558, endLng: 37.6173, name: 'SVO', color: '#50B6E8' }, // Russian Federation (Moscou)
  { startLat: 38.7223, startLng: -9.1393, endLat: 48.1486, endLng: 17.1077, name: 'BTS', color: '#50B6E8' }, // Slovakia (Bratislava)
  { startLat: 38.7223, startLng: -9.1393, endLat: 46.0569, endLng: 14.5058, name: 'LJU', color: '#50B6E8' }, // Slovenia (Liubliana)
  { startLat: 38.7223, startLng: -9.1393, endLat: 59.3293, endLng: 18.0686, name: 'ARN', color: '#50B6E8' }, // Sweden (Estocolmo)
  { startLat: 38.7223, startLng: -9.1393, endLat: 47.3769, endLng: 8.5417, name: 'ZRH', color: '#50B6E8' }, // Switzerland (Zurique)
  { startLat: 38.7223, startLng: -9.1393, endLat: 51.5099, endLng: -0.1180, name: 'LHR', color: '#50B6E8' }, // United Kingdom (Londres)

  // üåè √Åsia
  { startLat: 38.7223, startLng: -9.1393, endLat: 24.6333, endLng: 46.7167, name: 'RUH', color: '#50B6E8' }, // Ar√°bia Saudita (Riade - 1)
  { startLat: 38.7223, startLng: -9.1393, endLat: 39.9042, endLng: 116.4074, name: 'PEK', color: '#50B6E8' }, // CHINA (Pequim)
  { startLat: 38.7223, startLng: -9.1393, endLat: -6.2088, endLng: 106.8456, name: 'CGK', color: '#50B6E8' }, // Indon√©sia (Jacarta)
  { startLat: 38.7223, startLng: -9.1393, endLat: 35.6892, endLng: 51.3890, name: 'THR', color: '#50B6E8' }, // Ir√£ (Teer√£)
  { startLat: 38.7223, startLng: -9.1393, endLat: 32.0853, endLng: 34.7818, name: 'TLV', color: '#50B6E8' }, // Israel (Tel Aviv)
  { startLat: 38.7223, startLng: -9.1393, endLat: 31.9454, endLng: 35.9284, name: 'AMM', color: '#50B6E8' }, // Jordan (Am√£)
  { startLat: 38.7223, startLng: -9.1393, endLat: 29.3786, endLng: 47.9904, name: 'KWI', color: '#50B6E8' }, // Kuwait (Kuwait City)
  { startLat: 38.7223, startLng: -9.1393, endLat: 33.8938, endLng: 35.5018, name: 'BEY', color: '#50B6E8' }, // Lebanon (Beirute)
  { startLat: 38.7223, startLng: -9.1393, endLat: 47.9213, endLng: 106.9186, name: 'ULN', color: '#50B6E8' }, // Mong√≥lia (Ulan Bator)
  { startLat: 38.7223, startLng: -9.1393, endLat: 14.5995, endLng: 120.9842, name: 'MNL', color: '#50B6E8' }, // Philippines (Manila)
  { startLat: 38.7223, startLng: -9.1393, endLat: 25.2854, endLng: 51.5310, name: 'DOH', color: '#50B6E8' }, // Qatar (Doha)
  { startLat: 38.7223, startLng: -9.1393, endLat: 21.4858, endLng: 39.1925, name: 'JED', color: '#50B6E8' }, // Saudi Arabia (Jid√° - 2)
  { startLat: 38.7223, startLng: -9.1393, endLat: 25.0330, endLng: 121.5654, name: 'TPE', color: '#50B6E8' }, // Taiwan (Taipei)
  { startLat: 38.7223, startLng: -9.1393, endLat: 25.2048, endLng: 55.2708, name: 'DXB', color: '#50B6E8' }, // United Arab Emirates (Dubai)
  { startLat: 38.7223, startLng: -9.1393, endLat: 41.2995, endLng: 69.2401, name: 'TAS', color: '#50B6E8' }, // Uzbekistan (Tashkent)

  // üåä Oce√¢nia
  { startLat: 38.7223, startLng: -9.1393, endLat: -33.8678, endLng: 151.2073, name: 'SYD', color: '#50B6E8' } // Austr√°lia (Sydney)
];

        // 1. --- Preparar os Dados dos Pontos ---
        const pointsData = arcsData.map(d => ({
            lat: d.endLat,
            lng: d.endLng,
            size: d.name === 'Lisbon' ? 0.25 : 0.2, // Ligeiramente maior para a origem
            color: d.name === 'Lisbon' ? '#FFFFFF' : '#0058E8' // Branca para a origem, Azul escuro para as capitais
        }));

        // 2. --- Preparar os Dados dos R√≥tulos (Labels) ---
       const labelsData = arcsData.map(d => ({
          lat: d.endLat,
          lng: d.endLng,
          text: d.name,
          size: 0.001,
          color: 'gray',
          fontFace: 'Arial',
          labelDotRadius: 0.001,
          // Adicionando borda ao texto (se suportado)
          strokeColor: '#000000', // cor do contorno
          strokeWidth: 0.0005 // espessura do contorno
       }));

        // --- Globo ---
        const Globe = new ThreeGlobe()
            .globeImageUrl('https://static.wixstatic.com/media/a6967f_cbed4d361eb14d93aff8dcb6ede40613~mv2.jpg')
            .bumpImageUrl('//cdn.jsdelivr.net/npm/three-globe/example/img/earth-topology.png')
            .arcsData(arcsData)
            .arcColor('color')
            .arcDashLength(0.4)
            .arcDashGap(4)
            .arcDashInitialGap(() => Math.random() * 5)
            .arcDashAnimateTime(1000)
            
            // 3. --- Configura√ß√£o dos Pontos ---
            .pointsData(pointsData)
            .pointAltitude(0) // Altura do ponto (se zero, fica na superf√≠cie)
            .pointColor('color') // Cor do ponto
            .pointRadius(0.3) // Raio do ponto (controla o tamanho visual no ecr√£)
            
            // 4. --- Configura√ß√£o dos R√≥tulos (Labels) ---
            .labelsData(labelsData)
            .labelColor('color') // Cor do texto do r√≥tulo (branco)
            .labelAltitude(0.01) // Coloca o r√≥tulo ligeiramente acima da superf√≠cie
            .labelSize('size') // Tamanho do r√≥tulo
            .labelDotRadius('labelDotRadius') // Raio do ponto de conex√£o
            .labelText('text') // O campo a usar para o texto
            .labelResolution(3); // Aumenta a resolu√ß√£o do texto para melhor qualidade
            

        // --- Renderer ---
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setPixelRatio(Math.min(2, window.devicePixelRatio));
        document.getElementById('globeViz').appendChild(renderer.domElement);



        // --- Cena e luzes ---
        const scene = new THREE.Scene();
        // ‚úÖ DEFINI√á√ÉO DA COR DE FUNDO DA CENA 3D (Three.js)
        // Usando a cor escura do CSS de fundo para manter a harmonia visual
   
        
        
        // Fun√ß√£o para criar a textura de gradiente radial
function createRadialGradientTexture() {
    const size = 256;
    const canvas = document.createElement('canvas');
    canvas.width = size;
    canvas.height = size;
    const ctx = canvas.getContext('2d');

    // Cria um gradiente radial do centro para as bordas
    const gradient = ctx.createRadialGradient(
        size / 2, size / 2, 0.5, // centro e raio inicial
        size / 2, size / 2, size / 2 // centro e raio final
    );

    // Define as cores do gradiente radial
  //  gradient.addColorStop(0, '#000000'); // centro
    //gradient.addColorStop(0.4, '#ffffff'); // at√© 40%
  //  gradient.addColorStop(1, '#07070A'); // bordas


    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, size, size);

    const texture = new THREE.Texture();
    texture.needsUpdate = true;
    return texture;
}

// Criar a textura de gradiente radial e aplicar
const gradientTexture = createRadialGradientTexture();
scene.background = gradientTexture;
        
        
        
        
        
        
        
        scene.add(Globe);
        scene.add(new THREE.AmbientLight(0xffffff, Math.PI));
        scene.add(new THREE.DirectionalLight(0xf5f5f5, 4 * Math.PI));



        // --- C√¢mara ---
        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        
        
        
        
        // üìå POSI√á√ÉO DA C√ÇMARA (Vista Superior Deslocada)
        camera.position.x = -50; // Move a c√¢mara ligeiramente para a esquerda
        camera.position.y = 200;  // Move a c√¢mara para cima (vista superior)
        camera.position.z = 350; // Zoom mais perto (Ajustado para melhor vista)
        
        // 1. Rota√ß√£o da C√ÇMARA: Inclinar a vista em 20 graus para baixo no eixo X
        camera.rotation.x = THREE.MathUtils.degToRad(20);
        
        // ** ROTA√á√ÉO DO GLOBO (Centra o foco em Portugal: 38.72¬∫ N, -9.14¬∫ W) **
        // Latitude (N/S): -38.72 (negativo da latitude)
        Globe.rotation.x = THREE.MathUtils.degToRad(-38.7223); 
        // 2. Longitude (E/O): +9.14 (negativo da longitude -9.14)
        Globe.rotation.y = THREE.MathUtils.degToRad(9.1393);
        
        // --- Controlos ---
        const tbControls = new TrackballControls(camera, renderer.domElement);
        tbControls.minDistance = 101;
        tbControls.rotateSpeed = 5;
        tbControls.zoomSpeed = 0.8;

        // --- Resize Responsivo ---
        function onWindowResize() {
            const width = window.innerWidth;
            const height = window.innerHeight;
            renderer.setSize(width, height);
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
        }

        window.addEventListener('resize', onWindowResize);
        onWindowResize();

        // --- Rota√ß√£o autom√°tica (MODIFICADO) ---
        const ROTATE_SPEED = -0.005;
        // ** NOVO: Vari√°vel de estado para a rota√ß√£o **
        let isRotating = true;







        // --- Inicializa√ß√£o do Gr√°fico de Pizza (Pie Chart) ---
        function initializeChart() {
            const ctx = document.getElementById('machineChart').getContext('2d');
            
            // Dados fornecidos: Europa: 73.5, Am√©rica: 17.9, √Åfrica: 0.5, √Åsia: 7.1, Oce√¢nia: 1,0
            const machineData = {
                labels: ['EUROPA', 'AM√âRICA', '√ÅFRICA', '√ÅSIA', 'Oce√¢nia'],
                datasets: [{
                    data: [73.5, 17.9, 0.5, 7.1, 1.0], 
                    // üö® Paleta estritamente Cinzento e Branco com OPACIDADE (Alpha=0.8)
                    backgroundColor: [
                        'rgba(128, 128, 128, 0.8)', // Cinzento M√©dio (#808080)
                        'rgba(211, 211, 211, 0.8)', // Cinzento Claro (#D3D3D3)
                        'rgba(255, 255, 255, 0.8)', // Branco (#FFFFFF)
                        'rgba(80, 80, 80, 0.8)',  // Cinzento Escuro (#505050)
                        'rgba(49,47,49, 0.8)'    // Cinzento Escuro (#312f31)
                        
                    ],
                    // Paleta de HOVER (Alpha=1.0 para manter o contraste na intera√ß√£o)
                    hoverBackgroundColor: [
                        'rgba(153, 153, 153, 1.0)',
                        'rgba(255, 255, 255, 1.0)',
                        'rgba(204, 204, 204, 1.0)',
                        'rgba(102, 102, 102, 1.0)'
                    ],
                    borderColor: 'rgba(255, 255, 255, 0.2)', // Borda suave
                    borderWidth: 1
                }]
            };

            const config = {
                type: 'pie',
                data: machineData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        // Legenda removida para minimalismo
                        legend: {
                            display: false
                        },
                        tooltip: {
                             // Tooltip mantido para interatividade
                             callbacks: {
                                 label: function(context) {
                                     let label = context.label || '';
                                     if (label) {
                                         label += ': ';
                                     }
                                     if (context.parsed !== null) {
                                         const total = context.chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
                                         const value = context.parsed;
                                         // Calcula e exibe a percentagem real
                                         const percentage = ((value / total) * 100).toFixed(1);
                                         label += percentage + '%';
                                     }
                                     return label;
                                 }
                             },
                             bodyColor: '#333',
                             titleColor: '#333',
                             backgroundColor: 'rgba(255, 255, 255, 0.9)', // Fundo claro para contraste
                             borderColor: '#888',
                             borderWidth: 1
                        },
                        title: {
                            display: false
                        }
                    }
                }
            };

            new Chart(ctx, config);
        }





        // --- Loop de anima√ß√£o (MODIFICADO para a fun√ß√£o Play/Pause) ---
        function animate() {
            requestAnimationFrame(animate);
            
            // ** Condi√ß√£o para a Rota√ß√£o: S√ì roda se isRotating for true **
            if (isRotating) {
                // Rota√ß√£o principal no eixo Y
                Globe.rotation.y += ROTATE_SPEED;
            }
            
            tbControls.update();
            renderer.render(scene, camera);
        }






        // --- L√ìGICA DO BOT√ÉO PLAY/PAUSE (NOVO) ---
        document.addEventListener('DOMContentLoaded', () => {
            const playPauseBtn = document.getElementById('playPauseBtn');

            if (playPauseBtn) {
                playPauseBtn.addEventListener('click', () => {
                    isRotating = !isRotating; // Inverte o estado

                    // Atualiza o texto e a cor do bot√£o
                    if (isRotating) {
                        playPauseBtn.innerHTML = 'Pausar Rota√ß√£o';
                        playPauseBtn.style.backgroundColor = ''; // Azul
                    } else {
                        playPauseBtn.innerHTML = 'Iniciar Rota√ß√£o';
                        playPauseBtn.style.backgroundColor = ''; // Vermelho/Laranja para indicar parada
                    }
                });
            }
        });

        // Inicializa a anima√ß√£o e o gr√°fico
        animate();
        initializeChart();
    </script>
</body>
</html>
